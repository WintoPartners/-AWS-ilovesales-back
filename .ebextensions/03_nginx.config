files:
  "/etc/nginx/conf.d/proxy.conf":
    mode: "000644"
    owner: root
    group: root
    source: /var/app/current/.ebextensions/nginx/conf.d/proxy.conf

container_commands:
  01_create_nginx_dirs:
    command: |
      sudo mkdir -p /etc/nginx/conf.d
      sudo chmod 755 /etc/nginx/conf.d
  02_create_log_dirs:
    command: |
      sudo mkdir -p /var/log/nginx
      sudo touch /var/log/nginx/api.access.log /var/log/nginx/api.error.log
      sudo chown -R nginx:nginx /var/log/nginx
  03_reload_nginx:
    command: |
      sudo nginx -t
      sudo service nginx reload || sudo service nginx restart